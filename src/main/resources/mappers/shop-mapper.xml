<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="shopMapper">

	<resultMap type="Point" id="PointResultSet"> 
	
		<id property="pointNum" column="POINT_NUM"/>		
		<result property="userNo" column="USER_NO" />
		<result property="pointVal" column="POINT_VAL" />
		<result property="pointDate" column="POINT_DATE" />	
		<result property="pointType" column="POINT_TYPE" />
		
		
	</resultMap>
	
	
	<!-- 포인트 사용,적립 하는 쿼리 -->
	
	<insert id="insertPoint">
	
		INSERT INTO POINT VALUES
		(SEQ_POINT_NUM.NEXTVAL, #{userNo},#{pointVal},DEFAULT,#{pointType})
		
	</insert>
		
	
	
	<!-- My Point List : 내 포인트 내역 조회해오기 -->
	<select id="selectMyPoint" parameterType="Point" resultMap="PointResultSet">	
		 
	  SELECT *
	  FROM POINT
	  WHERE USER_NO=#{userNo}
	    
	</select>
	
	
	<resultMap type="PointInfo" id="PointInfoResultSet"> 
			
		<id property="userNo" column="USER_NO"/>		
		<result property="totalPoint" column="TOTAL_POINT" />	
		
		
	</resultMap>
	
	
	
	<!-- My Point TOTAL : 토탈포인트 조회해오기 -->
	<select id="selectPointTotal" parameterType="PointInfo" resultMap="PointInfoResultSet">	
		 
	  SELECT *
	  FROM POINT_INFO
	  WHERE USER_NO=#{userNo}
	    
	</select>
	
	
	<!-- 리뷰 리절트 맵 -->
	
	<resultMap type="ProReview" id="ProReviewResultSet"> 
	
		<id property="reviewNo" column="REVIEW_NO"/>		
		<result property="reviewWriter" column="REVIEW_WRITER" />
		<result property="proCode" column="PRO_CODE" />
		<result property="reviewStar" column="REVIEW_STAR" />	
		<result property="reviewTitle" column="REVIEW_TITLE" />
		<result property="reviewContent" column="REVIEW_CONTENT" />
		<result property="originName" column="ORIGIN_NAME" />
		<result property="changeName" column="CHANGE_NAME" />
		<result property="reviewDate" column="REVIEW_DATE" />
		<result property="reviewCount" column="REVIEW_COUNT" />
		<result property="reviewStatus" column="REVIEW_STATUS" />
		<result property="refOderNo" column="REF_ONO" />
		
		<result property="userId" column="USER_ID" />
		<result property="proName" column="PRO_NAME" />
		
		
	</resultMap>
	
	
	
	<!-- 리뷰등록(사용자) -->	
	<insert id="insertReview">	
	
		INSERT INTO PRO_REVIEW
		VALUES(SEQ_REVIEW_NO.NEXTVAL, #{reviewWriter}, #{proCode},#{reviewStar},#{reviewTitle},#{reviewContent},#{originName},#{changeName}, DEFAULT, DEFAULT,DEFAULT, #{refOderNo})
  
  	</insert>
  	
	
	
	
	
	<!-- 등록된 my 리뷰 수 -->
	<select id = "myReviewListCount" resultType="_int">

	SELECT COUNT(*)
  	FROM PRO_REVIEW
  	WHERE REVIEW_STATUS='Y'
	AND REVIEW_WRITER=#{userNo}
  	
    
  	</select>

	<!-- 등록된 my리뷰 select해오기 -->
	<select id="selectMyReviewList" parameterType="ProReview" resultMap="ProReviewResultSet">	
	  
	  SELECT *
	  FROM PRO_REVIEW A
	  JOIN MEMBER B ON A.REVIEW_WRITER = B.USER_NO
	  JOIN PRODUCT C ON A.PRO_CODE = C.PRO_CODE  
	  WHERE A.REVIEW_STATUS='Y'
	  AND REVIEW_WRITER=#{userNo}
	    
	</select>
	
	<!-- 리뷰갯수 체크 -->
	 <update id = "increaseCountReview" parameterType="_int">
    
	  UPDATE PRO_REVIEW
	  SET REVIEW_COUNT=REVIEW_COUNT+1
	  WHERE REVIEW_NO=#{reviewNo}
	  AND REVIEW_STATUS='Y'
  
  
  	</update>  
	
	<!-- 리뷰 불러오기 -1개? -->
	 <select id = "selectReview" parameterType="ProReview" resultMap="ProReviewResultSet">

	  SELECT *
	  FROM PRO_REVIEW A
	  JOIN MEMBER B ON A.REVIEW_WRITER = B.USER_NO
	  JOIN PRODUCT C ON A.PRO_CODE = C.PRO_CODE 	  	  
	  WHERE A.REVIEW_STATUS='Y'	  
	  AND A.REVIEW_NO=#{reviewNo}
    
  	</select>
  	
  	
    <!--리뷰 수정 -->
  	
  	<update id="updateReview" parameterType="ProReview">
  
  
	  UPDATE PRO_REVIEW
	  SET REVIEW_STAR=#{reviewStar}, REVIEW_TITLE=#{reviewTitle}, REVIEW_CONTENT=#{reviewContent}, ORIGIN_NAME=#{originName}, CHANGE_NAME=#{changeName}
	  WHERE REVIEW_NO=#{reviewNo}
	  
	  
	</update>
	
	
	
	<!--리뷰 삭제 -->	
  	<update id="deleteReview">
  
  		UPDATE PRO_REVIEW
  		SET REVIEW_STATUS='N'
  		WHERE REVIEW_NO=#{reviewNo}
    
  	</update>
  	
  	
  	
  	
  	
  	
  	<resultMap type="Product" id="productResultSet"> 
		<id property="proCode" column="PRO_CODE"/>		
		<result property="cateCode" column="CATE_CODE" />
		<result property="proName" column="PRO_NAME" />
		<result property="price" column="PRICE" />	
		<result property="detailOri" column="DETAIL_ORI" />
		<result property="detailCha" column="DETAIL_CHA" />
		<result property="proAmount" column="PRO_AMOUNT" />
		<result property="proStatus" column="PRO_STATUS" />
		<result property="proContent" column="PRO_CONTENT" />
		
	</resultMap>
	
  	
  	
	<!--등록된 product 수 (판매중인것) -->
	<select id = "productListCount" resultType="_int">

	SELECT COUNT(*)
  	FROM PRODUCT
  	WHERE PRO_STATUS='Y'
    
  	</select>

	<!--판매중인 제품 select해오기 -->
	<select id="selectShopList" parameterType="Product" resultMap="productResultSet">	
		 
	  SELECT *
	  FROM PRODUCT
	  WHERE PRO_STATUS='Y'
	    
	</select>
	
	
	<resultMap type="Cart" id="cartResultSet"> 
		<id property="cartNo" column="CART_NO"/>
		<result property="userNo" column="USER_NO" />
		<result property="proCode" column="PRO_CODE" />
		<result property="amount" column="AMOUNT" />
		
		
				
		<result property="cateCode" column="CATE_CODE" />
		<result property="proName" column="PRO_NAME" />
		<result property="price" column="PRICE" />	
		<result property="detailOri" column="DETAIL_ORI" />
		<result property="detailCha" column="DETAIL_CHA" />
		<result property="proAmount" column="PRO_AMOUNT" />
		<result property="proStatus" column="PRO_STATUS" />
		<result property="proContent" column="PRO_CONTENT" />
		
	</resultMap>
	
	
	<!--  cart select해오기 -->
	<select id = "selectCartList" parameterType="Cart" resultMap="cartResultSet">

	  SELECT *
	  FROM CART A	  
	  JOIN PRODUCT B ON A.PRO_CODE = B.PRO_CODE 	  	  
	  WHERE A.USER_NO=#{userNo}
    
  	</select>

	
	<!-- cart 삭제 -->
	
    <delete id="deleteCart">  
  		
  		DELETE FROM CART WHERE CART_NO=#{cartNo}
    
  	</delete>
  	


	<resultMap type="ProOrder" id="ProOrderResultSet"> 
	
		<id property="orderNo" column="ORDER_NO"/>		
		<result property="cartNo" column="CART_NO" />
		<result property="proCode" column="PRO_CODE" />
		<result property="freeNo" column="FREE_NO" />	
		<result property="userNo" column="USER_NO" />
		<result property="payCode" column="PAY_CODE" />
		<result property="amount" column="AMOUNT" />
		<result property="orderName" column="ORDER_NAME" />
		<result property="orderPhone" column="ORDER_PHONE" />
		<result property="address" column="ADDRESS" />
		<result property="addressDetail" column="ADDRESS_DETAIL" />
		<result property="orderStatus" column="ORDER_STATUS" />
		<result property="orderDate" column="ORDER_DATE" />
		<result property="orderRInsert" column="ORDER_R_INSERT" />
		
		<result property="proName" column="PRO_NAME" />
		
		
	</resultMap>
	
	
	<!-- 오더넘버로 제품 코트 select해오기 -->
	<select id="selectProductCode" resultType="string">	
		 
	  SELECT PRO_CODE
	  FROM PRO_ORDER
	  WHERE ORDER_NO=#{orderNo}
	    
	</select>
	
	
		
	<!--  내 주문 select해오기 -->
	<select id = "selectOrderList" parameterType="ProOrder" resultMap="ProOrderResultSet">

	  SELECT  A.*, B.PRO_NAME
	  FROM PRO_ORDER A	  
	  JOIN PRODUCT B ON A.PRO_CODE = B.PRO_CODE 	  	  
	  WHERE A.USER_NO=#{userNo}
	  AND A.ORDER_STATUS IN('C','Y','R')
    
  	</select>
  	
  	
  	<!--  내 취소 주문 select해오기 -->
	<select id = "selectOrderCancelList" parameterType="ProOrder" resultMap="ProOrderResultSet">

	  SELECT  A.*, B.PRO_NAME
	  FROM PRO_ORDER A	  
	  JOIN PRODUCT B ON A.PRO_CODE = B.PRO_CODE 	  	  
	  WHERE A.USER_NO=#{userNo}
	  AND A.ORDER_STATUS = 'N'
    
  	</select>
  	
  	
	
	<!-- 카트에 인서트하기 -->
	<insert id="insertCart">
	
		INSERT INTO CART VALUES
		(SEQ_CART_NO.NEXTVAL, #{userNo},#{proCode},#{amount})
		
	</insert>
	
	
	<!--관리자에게 주문 취소 요청하기 -->	
  	<update id="cancelRequestOrder">
  
  		UPDATE PRO_ORDER
  		SET ORDER_STATUS='R'
  		WHERE ORDER_NO=#{orderNo}
    
  	</update>
  	
  	
  	<!--주문 최종 확정하기 -->	
  	<update id="OkOrder">
  
  		UPDATE PRO_ORDER
  		SET ORDER_STATUS='C'
  		WHERE ORDER_NO=#{orderNo}
    
  	</update>
  	
  	
   	<!--오더테이블에 리뷰작성여부 Y로 업데이트하기 -->	
  	<update id="updateOTableReviewOk">
  
  		UPDATE PRO_ORDER
  		SET ORDER_R_INSERT='Y'
  		WHERE ORDER_NO=#{orderNo}
    
  	</update>
  	

</mapper>