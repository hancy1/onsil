<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >
<mapper namespace="helpMapper">

	<!-- 자주묻는질문 리절트맵 -->
	<resultMap type="Faq" id="faqResultSet">   
         <id property="faqNo" column="FAQ_NO"/>
         <result property="category" column="CATEGORY"/>
         <result property="question" column="QUESTION"/>
         <result property="answer" column="ANSWER"/>
         <result property="createDate" column="CREATE_DATE"/>
         <result property="status" column="STATUS"/>         
	</resultMap>
	
	<!-- 공지사항 리절트맵 -->
	<resultMap type="Notice" id="noticeResultSet">   
         <id property="noticeNo" column="NOTICE_NO"/>
         <result property="category" column="CATEGORY_NAME"/>
         <result property="title" column="TITLE"/>
         <result property="writer" column="USER_NAME"/>
         <result property="userId" column="USER_ID"/>
         <result property="createDate" column="CREATE_DATE"/>
         <result property="content" column="CONTENT"/>         
         <result property="status" column="STATUS"/>         
	</resultMap>
	
	<!-- 문의사항 리절트맵 -->
	<resultMap type="Inquiry" id="inquiryResultSet">   
         <id property="inquiryNo" column="INQUIRY_NO"/>
         <result property="category" column="CATEGORY_NAME"/>
         <result property="count" column="COUNT"/>
         <result property="title" column="TITLE"/>
         <result property="writer" column="USER_NAME"/>
         <result property="userId" column="USER_ID"/>
         <result property="userNo" column="USER_NO"/>
         <result property="createDate" column="CREATE_DATE"/>
         <result property="content" column="CONTENT"/>         
         <result property="open" column="OPEN"/>         
         <result property="status" column="STATUS"/>         
         <result property="replyCount" column="REPLYCOUNT"/>         
	</resultMap>
	
	<!-- 문의사항 답변 리절트맵 -->
	<resultMap type="Answer" id="answerResultSet">   
         <id property="answerNo" column="ANSWER_NO"/>
         <result property="writer" column="USER_NAME"/>
         <result property="userId" column="USER_ID"/>
         <result property="createDate" column="CREATE_DATE"/>
         <result property="answer" column="ANSWER"/>           
	</resultMap>
      

	<!-- 자주묻는질문 게시물 갯수 -->
	<select id="selectFaqListCount" resultType="_int">
		SELECT COUNT(*) FROM FAQ
	</select>
	
	<!-- 자주묻는질문 게시물들 불러오기 -->
	<select id="selectFaqList" resultMap="faqResultSet">
		SELECT * 
		FROM FAQ
		WHERE STATUS='Y'	
		ORDER BY FAQ_NO DESC	
	</select>
	
	<!-- 공지사항 게시물 갯수 -->
	<select id="selectNoticeListCount" resultType="_int">
		SELECT COUNT(*) FROM NOTICE
	</select>
	
	<!-- 공지사항 게시물들 불러오기 -->
	<select id="selectNoticeList" resultMap="noticeResultSet">		
		SELECT A.NOTICE_NO, B.CATEGORY_NAME, A.TITLE, C.USER_NAME, A.CREATE_DATE, A.CONTENT 
		FROM NOTICE A
		JOIN INFO_CATEGORY B ON A.CATEGORY = B.CATEGORY_CODE
        JOIN MEMBER C ON A.WRITER = C.USER_NO
		WHERE A.STATUS='Y'
		ORDER BY NOTICE_NO DESC		
	</select>
	
	<!-- 문의사항 게시물 갯수 -->
	<select id="selectInquiryListCount" resultType="_int">
		SELECT COUNT(*) FROM INQUIRY
	</select>
	
	<!-- 문의사항 게시물들 불러오기 -->
	<select id="selectInquiryList" resultMap="inquiryResultSet">		
		SELECT A.INQUIRY_NO, B.CATEGORY_NAME, A.TITLE, A.COUNT, C.USER_NAME, A.CREATE_DATE, A.CONTENT, A.OPEN, A.STATUS, A.REPLYCOUNT, C.USER_NO
		FROM INQUIRY A
		JOIN INFO_CATEGORY B ON A.CATEGORY = B.CATEGORY_CODE
		JOIN MEMBER C ON A.WRITER = C.USER_NO
		WHERE A.STATUS='Y'
		ORDER BY INQUIRY_NO DESC
	</select>
	
	<!-- 조회수 -->
	<update id = "increaseCount" parameterType="_int">
		UPDATE INQUIRY
		SET COUNT = COUNT+1
		WHERE INQUIRY_NO = #{ino} AND STATUS='Y'	
	</update>
	
	<!-- 공지사항 디테일뷰 -->
	<select id="selectNotice" resultMap="noticeResultSet">		
		SELECT A.NOTICE_NO, B.CATEGORY_NAME, A.TITLE, C.USER_NAME, A.CREATE_DATE, A.CONTENT, C.USER_ID
		FROM NOTICE A
		JOIN INFO_CATEGORY B ON A.CATEGORY = B.CATEGORY_CODE
        JOIN MEMBER C ON A.WRITER = C.USER_NO
		WHERE A.STATUS='Y'
		AND A.NOTICE_NO=#{nno}		
	</select>
	
	<!-- 문의사항 디테일 뷰 - 댓글 수 업데이트 -->
	<update id="updateReplyCount">
		UPDATE INQUIRY
		SET REPLYCOUNT = (
							SELECT COUNT(*)
							FROM ANSWER
							WHERE REPER_NO=#{ino}
		)
		WHERE INQUIRY_NO=#{ino}
	</update>
	
	
	<!-- 문의사항 디테일뷰 -->
	<select id="selectInquiry" resultMap="inquiryResultSet">		
		SELECT A.INQUIRY_NO, B.CATEGORY_NAME, A.TITLE, A.COUNT, C.USER_NAME, A.CREATE_DATE, A.CONTENT, A.OPEN, A.STATUS, A.REPLYCOUNT, C.USER_ID
		FROM INQUIRY A
		JOIN INFO_CATEGORY B ON A.CATEGORY = B.CATEGORY_CODE
        JOIN MEMBER C ON A.WRITER = C.USER_NO
		WHERE A.STATUS='Y'
		AND A.INQUIRY_NO=#{ino}		
	</select>	
	
	<!-- 문의사항 댓글리스트 -->
	<select id="selectReplyList" parameterType="_int" resultMap="answerResultSet">
	<![CDATA[
		SELECT A.ANSWER_NO, A.ANSWER, B.USER_ID, B.USER_NAME, A.CREATE_DATE
		FROM ANSWER A
		JOIN MEMBER B ON A.WRITER = B.USER_NO
		WHERE A.REPER_NO = #{ino} AND A.STATUS <> 'N'
		ORDER BY A.ANSWER_NO DESC
		]]>
	</select>
	
	<!-- 문의사항 댓글작성 -->
	<insert id="insertReply" parameterType="Answer">		
		INSERT INTO ANSWER VALUES
		(SEQ_ANSWER_NO.NEXTVAL, #{reperNo}, #{userNo}, DEFAULT, #{answer}, DEFAULT)	
	</insert>
	
	<!-- 문의사항 댓글삭제 -->
	<delete id="deleteReply">
		DELETE FROM ANSWER
		WHERE ANSWER_NO = #{answerNo}
	</delete>
	
	<!-- 댓글수정 -->
	<update id="updateReply">
		UPDATE ANSWER
		SET ANSWER = #{answer}
		WHERE ANSWER_NO = #{answerNo}
	</update>
	
	<!-- 문의사항 글 작성 -->
	<insert id="insertInquiry">
		INSERT INTO INQUIRY VALUES
		(SEQ_INQUIRY_NO.NEXTVAL, #{category}, DEFAULT, #{title}, #{userNo}, DEFAULT, #{content}, DEFAULT, DEFAULT, DEFAULT)
	</insert>
	
	<!-- 문의사항 글 수정 -->
	<update id="updateInquiry">
		UPDATE INQUIRY
		SET TITLE = #{title}, CONTENT = #{content}, CATEGORY = #{category}
		WHERE INQUIRY_NO = #{inquiryNo}
	</update>
	
	<!-- 문의사항 글 삭제 -->
	<delete id="deleteInquiry">
		UPDATE INQUIRY
		SET STATUS = 'N'
		WHERE INQUIRY_NO = #{ino}
	</delete>
</mapper>