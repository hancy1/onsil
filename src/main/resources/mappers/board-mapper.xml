<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="boardMapper">

	<resultMap type="com.uni.spring.board.model.dto.Board" id="boardResultSet"> 
		<id property="bNo" column="B_NO"/>
         <result property="userNo" column="USER_NO"/>
         <result property="bCategoryNo" column="B_CATEGORY_NO"/>
         <result property="bTitle" column="B_TITLE"/>
         <result property="bContent" column="B_CONTENT"/>
         <result property="bDate" column="B_DATE"/>
         <result property="bCount" column="B_COUNT"/>
         <result property="bOriginName" column="B_ORIGIN_NAME"/>
         <result property="bChangeName" column="B_CHANGE_NAME"/>
         <result property="bStatus" column="B_STATUS"/>
         <result property="userId" column="USER_ID"/>
         <result property="bCategoryName" column="B_CATEGORY_NAME"/>
	</resultMap>

	<resultMap type="Reply" id="replyResultSet">
		<id property="replyNo" column="RE_NO"/>
      	<result property="userNo" column="USER_NO"/>
      	<result property="bNo" column="B_NO"/>
      	<result property="reContent" column="RE_CONTENT"/>
      	<result property="reDate" column="RE_DATE"/>
      	<result property="reStatus" column="RE_STATUS"/>
	</resultMap>
	
	
	<!-- 게시글 카운트 -->
	<select id="selectListCount" resultType="_int"><!-- 파라미터 없음. 숫자만 출력하기 때문에 int로 함 -->
		SELECT COUNT(*)
		FROM BOARD
		WHERE B_STATUS='Y'
	</select>
	
	<!-- 게시판 목록 -->
	<select id="selectList" parameterType="Board" resultMap="boardResultSet">
		SELECT A.B_NO, C.B_CATEGORY_NAME, A.B_TITLE, B.USER_ID, A.B_DATE, A.B_COUNT 
		FROM BOARD A
		JOIN MEMBER B ON A.USER_NO = B.USER_NO
		JOIN B_CATEGORY C ON A.B_CATEGORY_NO = C.B_CATEGORY_NO
		WHERE B_STATUS='Y'
		ORDER BY B_NO DESC
	</select>
	
	<!-- 조회수 증가 -->
	<update id="increaseCount" parameterType="_int">
		UPDATE BOARD
		SET B_COUNT = B_COUNT + 1
		WHERE B_NO=#{bno}
		AND B_STATUS = 'Y' 
	</update>

	<!-- 게시글 선택 -->
	<select id="selectBoard" parameterType="_int" resultMap="boardResultSet">
		SELECT C.B_CATEGORY_NAME, A.B_TITLE, B.USER_ID, A.B_DATE, A.B_CONTENT, A.B_CHANGE_NAME
		FROM BOARD A
		JOIN MEMBER B ON A.USER_NO = B.USER_NO
		JOIN B_CATEGORY C ON A.B_CATEGORY_NO = C.B_CATEGORY_NO
		WHERE B_NO=#{bno}
		AND B_STATUS = 'Y' 
	</select>
	
	<!-- 게시글 작성 -->
	<insert id="insertBoard" parameterType="Board">
		INSERT INTO BOARD VALUES
        (SEQ_B_NO.NEXTVAL, #{userNo}, #{BCategoryNo}, #{BTitle}, #{BContent}, SYSDATE, DEFAULT, #{BOriginName}, #{BChangeName}, DEFAULT)
	</insert>
		
	<!-- 게시글 삭제 -->	
	<update id="deleteBoard" parameterType="_int">
		UPDATE BOARD
		SET B_STATUS = 'N' 
		WHERE B_NO=#{bno}	
	</update>
	
	<!-- 게시글 수정 -->
	<update id="updateBoard" parameterType="Board">
		UPDATE BOARD
		SET B_TITLE=#{bTitle}, B_CONTENT=#{bContent}, B_ORIGIN_NAME=#{bOriginName}, B_CHANGE_NAME=#{bChangeName}
		WHERE B_NO=#{bno}	
	</update>
	
	<!-- 댓글 목록 -->
	<select  id="selectReplyList" parameterType="_int" resultMap="replyResultSet">
		SELECT RE_NO, USER_NO, RE_CONTENT, RE_DATE
		FROM REPLY
		WHERE B_NO=#{bno}
		AND RE_STATUS='Y'
		ORDER BY RE_NO DESC
	</select>
	
	<!-- 댓글 작성 -->
	<insert id="insertReply">
	
	</insert>
</mapper>