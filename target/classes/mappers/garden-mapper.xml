<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper 
PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" 
"http://mybatis.org/dtd/mybatis-3-mapper.dtd" >

<mapper namespace="gardenMapper">

	<resultMap type="com.uni.spring.garden.model.dto.VisitorBoard" id="VBoardResultSet"> 
		<id property="boardNo" column="BOARD_NO"/>
		<result property="writer" column="USER_ID" />		
		<result property="hostUser" column="HOST_USER" />
		<result property="content" column="CONTENT" />
		<result property="enrollDate" column="ENROLL_DATE" />	
		<result property="status" column="STATUS" />
	</resultMap>

	
	<select id="getBoardList" parameterType="string" resultMap="VBoardResultSet">
		
		<![CDATA[
		SELECT *
		FROM (
			SELECT A.BOARD_NO, B.USER_ID, A.HOST_USER, A.CONTENT, A.ENROLL_DATE, A.STATUS
			FROM VISITOR_BOARD A
			JOIN MEMBER B ON A.WRITER = B.USER_NO
			WHERE A.HOST_USER = #{hostUser} 
			AND A.STATUS='Y'
			ORDER BY A.BOARD_NO DESC)
		WHERE ROWNUM <= 3
		]]>
	
	</select>
	
	<select id="selectListCount" resultType="_int">
	
		SELECT COUNT(*)
		FROM VISITOR_BOARD
		WHERE HOST_USER = #{hostUser}
		AND STATUS = 'Y'
	
	</select>
	
	<select id="getBoardListAll" resultMap="VBoardResultSet">
	
		SELECT *
		FROM (
			SELECT A.BOARD_NO, B.USER_ID, A.HOST_USER, A.CONTENT, A.ENROLL_DATE, A.STATUS
			FROM VISITOR_BOARD A
			JOIN MEMBER B ON A.WRITER = B.USER_NO
			WHERE A.HOST_USER = #{hostUser} 
			AND A.STATUS='Y'
			ORDER BY A.BOARD_NO DESC)
	
	</select>
	
	<insert id="insertBoard">
	
		INSERT INTO VISITOR_BOARD VALUES
		(SEQ_V_BOARD_NO.NEXTVAL, #{writer}, #{hostUser}, #{content}, DEFAULT, DEFAULT)
		
	</insert>
	
	<update id="deleteBoard">
	
		UPDATE VISITOR_BOARD
		SET STATUS = 'N'
		WHERE BOARD_NO = #{boardNo}
		
	</update>
	
	
	
	
	<!-- 이웃관리 -->
	
	<resultMap type="Neighbor" id="NeighborResultSet"> 
		<id property="neighborNo" column="NEIGHBOR_NO"/>
		<result property="userNo" column="USER_NO" />		
		<result property="nUserNo" column="USER_ID" />
		<result property="enrollDate" column="ENROLL_DATE" />	
		<result property="status" column="STATUS" />
	</resultMap>
	
	<select id="getNeighborList" resultMap="NeighborResultSet">
	
		SELECT A.NEIGHBOR_NO, B.USER_ID, A.ENROLL_DATE, A.STATUS
		FROM NEIGHBOR A
		JOIN MEMBER B ON A.N_USER_NO = B.USER_NO
		WHERE A.USER_NO = #{userNo}
		AND A.STATUS = 'Y'
		ORDER BY A.ENROLL_DATE DESC
	
	</select>
	
	<update id="deleteNeighbor">
	
		UPDATE NEIGHBOR
		SET STATUS = 'N'
		WHERE NEIGHBOR_NO = #{neighborNo}
		
	</update>
	
	<insert id="insertNeighbor">
	
		INSERT INTO NEIGHBOR VALUES
		(SEQ_NEIGHBOR_NO.NEXTVAL, #{userNo}, (SELECT USER_NO FROM MEMBER WHERE USER_ID = #{nUserId}), DEFAULT, DEFAULT)
	
	</insert>
</mapper>